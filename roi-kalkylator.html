<!DOCTYPE html>
<html lang="sv">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROI-kalkylator | Beräkna din marknadsföringslönsamhet</title>
  <meta name="description"
    content="Beräkna din marknadsföringslönsamhet enkelt. ROI-kalkylator för leads, konvertering, intäkter och annonskostnader.">
  <style>
    /* ============================================
       1. Reset & Base Styles
       ============================================ */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      background: #F8F9FA;
      color: #1D3557;
      line-height: 1.5;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ============================================
       2. Design Tokens
       ============================================ */
    :root {
      --color-primary: #F5A623;
      --color-primary-hover: #E09000;
      --color-text-primary: #000000;
      --color-text-secondary: #555555;
      --color-text-muted: #888888;
      --color-background: #F8F9FA;
      --color-card: #FFFFFF;
      --color-border: #E5E8EB;
      --color-table-header: #000000;
      --color-success: #34C759;
      --color-error: #FF3B30;

      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 48px;

      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;

      --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.06);
      --shadow-card-hover: 0 4px 16px rgba(0, 0, 0, 0.1);

      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
    }

    /* Dark Mode Theme */
    [data-theme="dark"] {
      --color-primary: #F5A623;
      --color-primary-hover: #FFB84D;
      --color-text-primary: #FFFFFF;
      --color-text-secondary: #B0B0B0;
      --color-text-muted: #777777;
      --color-background: #1A1A1A;
      --color-card: #2A2A2A;
      --color-border: #3D3D3D;
      --color-table-header: #3A3A3A;
      --color-success: #34C759;
      --color-error: #FF453A;
      --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    /* ============================================
       3. Layout & Container
       ============================================ */
    .calculator-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 50px var(--spacing-md);
    }

    @media (min-width: 768px) {
      .calculator-container {
        padding: 50px var(--spacing-lg);
      }
    }

    header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
    }

    header h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-sm);
    }

    header .subtitle {
      font-size: 16px;
      color: var(--color-text-secondary);
    }

    /* Two Column Layout */
    .calculator-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
      align-items: start;
    }

    @media (min-width: 768px) {
      .calculator-layout {
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-xl);
        align-items: start;
      }
    }

    /* ============================================
       4. Cards
       ============================================ */
    .card {
      background: var(--color-card);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-card);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    /* ============================================
       5. Currency Selector
       ============================================ */
    .currency-selector {
      display: flex;
      gap: var(--spacing-xs);
      background: var(--color-background);
      border-radius: var(--radius-sm);
      padding: 3px;
    }

    .currency-btn {
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 500;
      color: var(--color-text-secondary);
      background: transparent;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .currency-btn:hover {
      color: var(--color-text-primary);
    }

    .currency-btn.active {
      background: var(--color-card);
      color: var(--color-text-primary);
      font-weight: 600;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    /* ============================================
       6. Slider Input Groups
       ============================================ */
    .slider-group {
      margin-bottom: var(--spacing-xl);
    }

    .slider-group:last-child {
      margin-bottom: 0;
    }

    .slider-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: var(--spacing-sm);
    }

    .slider-label {
      font-size: 15px;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .slider-value {
      font-size: 16px;
      font-weight: 700;
      color: var(--color-text-primary);
      min-width: 80px;
      text-align: right;
    }

    /* Custom Range Slider */
    .slider-wrapper {
      position: relative;
      margin-bottom: var(--spacing-xs);
    }

    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: var(--color-border);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--color-primary);
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid var(--color-card);
      box-shadow: 0 2px 6px rgba(245, 166, 35, 0.4);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 3px 10px rgba(245, 166, 35, 0.5);
    }

    input[type="range"]::-webkit-slider-thumb:active {
      transform: scale(1.15);
    }

    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: var(--color-primary);
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid var(--color-card);
      box-shadow: 0 2px 6px rgba(245, 166, 35, 0.4);
    }

    input[type="range"]::-moz-range-track {
      height: 6px;
      background: var(--color-border);
      border-radius: 3px;
    }

    /* Slider progress fill */
    .slider-track {
      position: absolute;
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      height: 6px;
      background: var(--color-primary);
      border-radius: 3px;
      pointer-events: none;
      z-index: 1;
    }

    input[type="range"] {
      position: relative;
      z-index: 2;
      background: transparent;
    }

    .slider-wrapper::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      transform: translateY(-50%);
      height: 6px;
      background: var(--color-border);
      border-radius: 3px;
      z-index: 0;
    }

    .slider-range {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--color-text-muted);
      margin-top: 4px;
    }

    .slider-help {
      font-size: 13px;
      color: var(--color-text-secondary);
      font-style: italic;
      margin-top: var(--spacing-sm);
    }

    /* ============================================
       7. Results Summary Table
       ============================================ */
    .results-section {
      opacity: 1;
      transition: opacity var(--transition-normal);
    }

    .results-section.hidden {
      opacity: 0.5;
    }

    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-lg);
    }

    .summary-table thead {
      background: var(--color-table-header);
    }

    .summary-table th {
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: 13px;
      font-weight: 600;
      color: white;
      text-align: left;
    }

    .summary-table th:last-child {
      text-align: right;
    }

    .summary-table thead tr {
      border-radius: var(--radius-sm);
    }

    .summary-table thead th:first-child {
      border-radius: var(--radius-sm) 0 0 var(--radius-sm);
    }

    .summary-table thead th:last-child {
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    }

    .summary-table tbody td {
      padding: var(--spacing-md);
      font-size: 14px;
      color: var(--color-text-primary);
      border-bottom: 1px solid var(--color-border);
    }

    .summary-table tbody td:last-child {
      text-align: right;
      font-weight: 500;
    }

    .summary-table tbody tr:last-child td {
      border-bottom: none;
    }

    /* Results Total Section */
    .results-totals {
      padding-top: var(--spacing-md);
      border-top: 2px solid var(--color-border);
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-sm) 0;
    }

    .result-row.highlight {
      padding: var(--spacing-md) 0;
    }

    .result-label {
      font-size: 15px;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .result-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--color-text-primary);
    }

    .result-value.positive {
      color: var(--color-success);
    }

    .result-value.negative {
      color: var(--color-error);
    }

    /* Additional Results */
    .additional-results {
      margin-top: var(--spacing-lg);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--color-border);
    }

    .additional-result {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-sm) 0;
    }

    .additional-result .label {
      font-size: 14px;
      color: var(--color-text-secondary);
    }

    .additional-result .value {
      font-size: 15px;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    /* ROI Visual Indicator */
    .roi-indicator {
      margin-top: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--color-background);
      border-radius: var(--radius-md);
    }

    .roi-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-sm);
    }

    .roi-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--color-text-secondary);
    }

    .roi-value {
      font-size: 24px;
      font-weight: 700;
    }

    .roi-value.positive {
      color: var(--color-success);
    }

    .roi-value.negative {
      color: var(--color-error);
    }

    .roi-bar {
      height: 8px;
      background: var(--color-border);
      border-radius: 4px;
      overflow: hidden;
    }

    .roi-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 400ms ease-out, background-color var(--transition-normal);
    }

    .roi-bar-fill.positive {
      background: linear-gradient(90deg, var(--color-success), #30D158);
    }

    .roi-bar-fill.negative {
      background: linear-gradient(90deg, var(--color-error), #FF453A);
    }

    /* ============================================
       8. Dropdown Toggle (for mobile)
       ============================================ */
    .dropdown-toggle {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      background: none;
      border: none;
      cursor: pointer;
      padding: var(--spacing-xs);
      color: var(--color-text-secondary);
      transition: color var(--transition-fast);
    }

    .dropdown-toggle:hover {
      color: var(--color-text-primary);
    }

    .dropdown-toggle svg {
      width: 16px;
      height: 16px;
      transition: transform var(--transition-fast);
    }

    .dropdown-toggle.open svg {
      transform: rotate(180deg);
    }

    /* ============================================
       9. Animations
       ============================================ */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: fadeIn 300ms ease-out forwards;
    }

    /* ============================================
       10. Responsive Adjustments
       ============================================ */
    @media (max-width: 767px) {
      header h1 {
        font-size: 24px;
      }

      .card {
        padding: var(--spacing-md);
      }

      .slider-value {
        font-size: 15px;
      }

      .result-value {
        font-size: 16px;
      }

      .roi-value {
        font-size: 20px;
      }
    }

    /* Touch-friendly targets */
    @media (hover: none) and (pointer: coarse) {
      input[type="range"]::-webkit-slider-thumb {
        width: 28px;
        height: 28px;
      }

      input[type="range"]::-moz-range-thumb {
        width: 28px;
        height: 28px;
      }
    }

    /* ============================================
       11. Dark Mode Toggle
       ============================================ */
    .theme-toggle-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: var(--spacing-lg);
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--color-border);
    }

    .theme-toggle-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--color-text-secondary);
    }

    .theme-toggle {
      position: relative;
      width: 48px;
      height: 26px;
    }

    .theme-toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--color-border);
      transition: background-color var(--transition-normal);
      border-radius: 26px;
    }

    .toggle-slider::before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: transform var(--transition-normal);
      border-radius: 50%;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .theme-toggle input:checked+.toggle-slider {
      background-color: var(--color-primary);
    }

    .theme-toggle input:checked+.toggle-slider::before {
      transform: translateX(22px);
    }

    .theme-toggle input:focus-visible+.toggle-slider {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }

    /* ============================================
       12. Utility Classes
       ============================================ */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>

<body>
  <div class="calculator-container">

    <div class="calculator-layout">
      <!-- Left Column: Inputs -->
      <div class="card">
        <!-- Slider: Antal Leads -->
        <div class="slider-group">
          <div class="slider-header">
            <label class="slider-label" for="leads">Antal leads</label>
            <span class="slider-value" id="leads-value">500</span>
          </div>
          <div class="slider-wrapper">
            <div class="slider-track" id="leads-track" style="width: 5.06%;"></div>
            <input type="range" id="leads" name="leads" min="100" max="8000" step="100" value="500"
              aria-describedby="leads-help">
          </div>
          <div class="slider-range">
            <span>100</span>
            <span>8000</span>
          </div>
          <p class="slider-help" id="leads-help">Antalet personer som ser din digitala produkt</p>
        </div>

        <!-- Slider: Konvertering -->
        <div class="slider-group">
          <div class="slider-header">
            <label class="slider-label" for="conversion-rate">Konvertering i procent (%)</label>
            <span class="slider-value" id="conversion-value">2</span>
          </div>
          <div class="slider-wrapper">
            <div class="slider-track" id="conversion-track" style="width: 5.26%;"></div>
            <input type="range" id="conversion-rate" name="conversionRate" min="1" max="20" step="0.5" value="2"
              aria-describedby="conversion-help">
          </div>
          <div class="slider-range">
            <span>1</span>
            <span>20</span>
          </div>
          <p class="slider-help" id="conversion-help">Av alla leads är det dessa som köper</p>
        </div>

        <!-- Slider: Pris -->
        <div class="slider-group">
          <div class="slider-header">
            <label class="slider-label" for="product-price">Pris på din digitala produkt</label>
            <span class="slider-value" id="price-value">2,000</span>
          </div>
          <div class="slider-wrapper">
            <div class="slider-track" id="price-track" style="width: 6.35%;"></div>
            <input type="range" id="product-price" name="productPrice" min="100" max="30000" step="100" value="2000"
              aria-describedby="price-help">
          </div>
          <div class="slider-range">
            <span>100</span>
            <span>30000</span>
          </div>
        </div>

        <!-- Slider: Annonskostnad -->
        <div class="slider-group">
          <div class="slider-header">
            <label class="slider-label" for="ad-spend">Annonskostnad</label>
            <span class="slider-value" id="adspend-value">10,000</span>
          </div>
          <div class="slider-wrapper">
            <div class="slider-track" id="adspend-track" style="width: 20%;"></div>
            <input type="range" id="ad-spend" name="adSpend" min="0" max="50000" step="500" value="10000"
              aria-describedby="adspend-help">
          </div>
          <div class="slider-range">
            <span>0</span>
            <span>50000</span>
          </div>
        </div>

        <!-- Dark Mode Toggle -->
        <div class="theme-toggle-wrapper">
          <span class="theme-toggle-label">Dark Mode</span>
          <label class="theme-toggle">
            <input type="checkbox" id="theme-toggle" aria-label="Byt till dark mode">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <!-- Right Column: Results -->
      <div class="card results-section" id="results">
        <div class="card-header">
          <h2 class="card-title">Ditt resultat</h2>
          <div class="currency-selector" role="radiogroup" aria-label="Välj valuta">
            <button type="button" class="currency-btn active" data-currency="SEK" role="radio"
              aria-checked="true">SEK</button>
            <button type="button" class="currency-btn" data-currency="USD" role="radio"
              aria-checked="false">USD</button>
            <button type="button" class="currency-btn" data-currency="EUR" role="radio"
              aria-checked="false">EUR</button>
          </div>
        </div>

        <!-- Summary Table -->
        <table class="summary-table">
          <thead>
            <tr>
              <th>Namn</th>
              <th>Totalt</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Antal leads</td>
              <td id="summary-leads">500</td>
            </tr>
            <tr>
              <td>Konvertering i procent (%)</td>
              <td id="summary-conversion">2</td>
            </tr>
            <tr>
              <td>Pris på din digitala produkt</td>
              <td id="summary-price">2,000 SEK</td>
            </tr>
          </tbody>
        </table>

        <!-- Totals -->
        <div class="results-totals">
          <div class="result-row highlight">
            <span class="result-label">Total intäkt</span>
            <span class="result-value" id="result-revenue">20,000 SEK</span>
          </div>
          <div class="result-row">
            <span class="result-label">Antal kunder</span>
            <span class="result-value" id="result-customers">10st</span>
          </div>
        </div>

        <!-- Additional Metrics -->
        <div class="additional-results">
          <div class="additional-result">
            <span class="label">Annonskostnad</span>
            <span class="value" id="result-adspend">10,000 SEK</span>
          </div>
          <div class="additional-result">
            <span class="label">Nettointäkt</span>
            <span class="value" id="result-net">10,000 SEK</span>
          </div>
          <div class="additional-result">
            <span class="label">Kostnad per lead</span>
            <span class="value" id="result-cpl">20 SEK</span>
          </div>

        </div>


      </div>
    </div>
  </div>

  <script>
    (function () {
      'use strict';

      // ============================================
      // State Management
      // ============================================
      const state = {
        currency: 'SEK',
        leads: 500,
        conversionRate: 2,
        productPrice: 2000,
        adSpend: 10000
      };

      // ============================================
      // Currency Configuration
      // ============================================
      const currencyConfig = {
        SEK: {
          symbol: 'SEK',
          position: 'after',
          thousandSeparator: ',',
          decimalSeparator: '.',
        },
        USD: {
          symbol: '$',
          position: 'before',
          thousandSeparator: ',',
          decimalSeparator: '.',
        },
        EUR: {
          symbol: '€',
          position: 'before',
          thousandSeparator: ' ',
          decimalSeparator: ',',
        }
      };

      // ============================================
      // DOM Elements
      // ============================================
      const elements = {
        sliders: {
          leads: document.getElementById('leads'),
          conversionRate: document.getElementById('conversion-rate'),
          productPrice: document.getElementById('product-price'),
          adSpend: document.getElementById('ad-spend')
        },
        values: {
          leads: document.getElementById('leads-value'),
          conversionRate: document.getElementById('conversion-value'),
          productPrice: document.getElementById('price-value'),
          adSpend: document.getElementById('adspend-value')
        },
        tracks: {
          leads: document.getElementById('leads-track'),
          conversionRate: document.getElementById('conversion-track'),
          productPrice: document.getElementById('price-track'),
          adSpend: document.getElementById('adspend-track')
        },
        summary: {
          leads: document.getElementById('summary-leads'),
          conversion: document.getElementById('summary-conversion'),
          price: document.getElementById('summary-price')
        },
        results: {
          revenue: document.getElementById('result-revenue'),
          customers: document.getElementById('result-customers'),
          adspend: document.getElementById('result-adspend'),
          net: document.getElementById('result-net'),
          cpl: document.getElementById('result-cpl')
        },
        currencyButtons: document.querySelectorAll('.currency-btn'),
        themeToggle: document.getElementById('theme-toggle')
      };

      // ============================================
      // Utility Functions
      // ============================================
      function formatNumber(value, decimals = 0) {
        const config = currencyConfig[state.currency];
        const parts = value.toFixed(decimals).split('.');
        const integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, config.thousandSeparator);

        if (decimals === 0 || !parts[1]) {
          return integerPart;
        }

        return integerPart + config.decimalSeparator + parts[1];
      }

      function formatCurrency(value, decimals = 0) {
        const config = currencyConfig[state.currency];
        const formattedNumber = formatNumber(value, decimals);

        if (config.position === 'before') {
          return config.symbol + formattedNumber;
        } else {
          return formattedNumber + ' ' + config.symbol;
        }
      }

      function updateSliderTrack(slider, track) {
        const min = parseFloat(slider.min);
        const max = parseFloat(slider.max);
        const value = parseFloat(slider.value);
        const percentage = ((value - min) / (max - min)) * 100;
        track.style.width = percentage + '%';
      }

      // ============================================
      // Calculation Logic
      // ============================================
      function calculateResults() {
        const customers = state.leads * (state.conversionRate / 100);
        const revenue = customers * state.productPrice;
        const netRevenue = revenue - state.adSpend;

        const roi = state.adSpend > 0 ? ((revenue - state.adSpend) / state.adSpend) * 100 : 0;
        const costPerLead = state.leads > 0 ? state.adSpend / state.leads : 0;
        const cac = customers > 0 ? state.adSpend / customers : 0;

        return {
          customers: Math.round(customers),
          revenue,
          adSpend: state.adSpend,
          netRevenue,
          roi,
          costPerLead,
          cac
        };
      }

      // ============================================
      // Update Display
      // ============================================
      function updateDisplay() {
        // Update slider value displays
        elements.values.leads.textContent = formatNumber(state.leads);
        elements.values.conversionRate.textContent = state.conversionRate;
        elements.values.productPrice.textContent = formatNumber(state.productPrice);
        elements.values.adSpend.textContent = formatNumber(state.adSpend);

        // Update summary table
        elements.summary.leads.textContent = formatNumber(state.leads);
        elements.summary.conversion.textContent = state.conversionRate;
        elements.summary.price.textContent = formatCurrency(state.productPrice);

        // Calculate and update results
        const results = calculateResults();

        elements.results.revenue.textContent = formatCurrency(results.revenue);
        elements.results.customers.textContent = results.customers + 'st';
        elements.results.adspend.textContent = formatCurrency(results.adSpend);
        elements.results.net.textContent = formatCurrency(results.netRevenue);
        elements.results.cpl.textContent = formatCurrency(results.costPerLead, 0);

        // Update net color
        elements.results.net.classList.remove('positive', 'negative');
        if (results.netRevenue > 0) {
          elements.results.net.classList.add('positive');
        } else if (results.netRevenue < 0) {
          elements.results.net.classList.add('negative');
        }


      }

      // ============================================
      // Event Handlers
      // ============================================
      function handleSliderInput(event) {
        const slider = event.target;
        const name = slider.name;
        const value = parseFloat(slider.value);

        // Map slider names to state keys
        const stateKeyMap = {
          leads: 'leads',
          conversionRate: 'conversionRate',
          productPrice: 'productPrice',
          adSpend: 'adSpend'
        };

        const stateKey = stateKeyMap[name];
        if (stateKey) {
          state[stateKey] = value;
        }

        // Update track
        const trackKey = stateKey;
        if (elements.tracks[trackKey]) {
          updateSliderTrack(slider, elements.tracks[trackKey]);
        }

        updateDisplay();
      }

      function handleCurrencyChange(event) {
        const button = event.target.closest('.currency-btn');
        if (!button) return;

        const newCurrency = button.dataset.currency;
        if (newCurrency === state.currency) return;

        state.currency = newCurrency;

        // Update button states
        elements.currencyButtons.forEach(btn => {
          const isActive = btn.dataset.currency === newCurrency;
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-checked', isActive.toString());
        });

        updateDisplay();
      }

      // ============================================
      // Initialization
      // ============================================
      function init() {
        // Initialize slider tracks
        Object.keys(elements.sliders).forEach(key => {
          const slider = elements.sliders[key];
          const track = elements.tracks[key];
          if (slider && track) {
            updateSliderTrack(slider, track);
            slider.addEventListener('input', handleSliderInput);
          }
        });

        // Currency selector
        elements.currencyButtons.forEach(button => {
          button.addEventListener('click', handleCurrencyChange);
        });

        // Theme toggle
        if (elements.themeToggle) {
          elements.themeToggle.addEventListener('change', (e) => {
            const isDark = e.target.checked;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
          });
        }

        // Initial display update
        updateDisplay();
      }

      // Start
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>

</html>